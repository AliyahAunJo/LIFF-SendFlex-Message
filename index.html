<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
    <title>LINE SEND MESSAGE By KruAun Jaidee</title>
    <link rel="stylesheet" href="flex2html.css" />
    <script type="text/javascript" src="flex2html.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

    <style>
        body {
            /* box-sizing: border-box; */
            /* border: 1px solid; */
            /* margin: 30px 30px; */
            /* box-decoration-break: unset; */
            /* display: flex; */
            /* align-items: center; */
            /* justify-content: center; */
            /* border-radius: 15px; */
            background-color: rgb(36, 72, 94);
            /* overflow: hidden;  */
        }

        input {
            width: 30px;
            border-radius: 5px;
            box-shadow: 1px 1px 10px 0.5px grey;
        }

        #label1 {
            margin-left: 0px;
        }

        #label2 {
            margin-left: 0px;
        }
    </style>

</head>

<body>
    <div class="container">
        <form class="form-control-sm">
            <center>
                <img id="pictureUrl" class="img-circle mb-2 mt-3" alt="Cinque Terre" width="50" height="50" />
                <p class="text-white mb-2" id="displayName"></p>
            </center>
            <p class="text-white mb-2" id="userId"></p>
            <p class="text-white mb-2" id="statusMessage"></p>
            <p class="text-white mb-2" id="getDecodedIDToken"></p>
            <h2 class="mt-3 text-white">❤️ Send Message ❤️</h2>
            <button style="background-color: rgb(7, 170, 207);" class="btn btn-outline-danger mb-3 text-white"
                onclick="goSimulator()">
                ไปที่ Flex Simulator
            </button>
            <br />
            <label id="label1" class="text-white mb-3" for="">ข้อมูลที่ 1</label>
            <input class="form-control mb-3 row=3" type="text" name="" id="textBox1" width="30px
      " />

            <label id="label2" class="text-white mb-3" for="">ข้อมูลที่ 2</label>

            <textarea class="form-control" id="textBox2" width="30px" onchange="showFlex()"></textarea>
            <br />

            <div class="chatbox">
                <div class="" id="flex1"></div>
            </div>
            <p class=" mb-3 mt-3 text-white">กดปุ่มเพื่อส่งไปหาเพื่อนของคุณ</p>
            <div class="">
                <button class="btn btn-danger mb-3" type="button" onclick="myFunction()">
                    ส่ง Flex
                </button>
                <button style="background-color: rgb(7, 207, 80);" class="btn btn-success mb-3" type="button"
                    onclick="sendText()">
                    ส่ง ข้อความ
                </button>
                <button style="background-color: rgb(162, 80, 255);" class="btn btn-success mb-3" type="button"
                    onclick="sendImage()">
                    ส่ง รูปภาพ
                </button>
                <button style="background-color: rgb(249, 48, 225);" class="btn btn-success mb-3" type="button"
                    onclick="sendVideo()">
                    ส่ง วิดีโอ
                </button>
                <button style="background-color: rgb(239, 129, 26);" class="btn btn-primary mb-3" type="button"
                    onclick="sendLocation()">
                    ส่ง โลเคชั่น
                </button>
        </form>
    </div>




    <p class="mt-5 text-white" id="demo"></p>
    <hr class="text-white" />
    <center>
        <p class="text-white">❤️ พัฒนาโดย ครูอั๋นใจดี ❤️</p>
    </center>
    <br />
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>

        // function runApp() {
        //     liff.getProfile().then(profile => {
        //         document.getElementById("pictureUrl").src = profile.pictureUrl;  // %u0E41%u0E2A%u0E14%u0E07%u0E23%u0E39%u0E1B Profile %u0E17%u0E35%u0E48%u0E14%u0E36%u0E07%u0E21%u0E32
        //         document.getElementById("userId").innerHTML = '<b>UserId:</b> ' + profile.userId;
        //         document.getElementById("displayName").innerHTML = '<b>สวัสดี:</b> ' + profile.displayName; // %u0E41%u0E2A%u0E14%u0E07%u0E0A%u0E37%u0E48%u0E2D Line %u0E02%u0E2D%u0E07%u0E1C%u0E39%u0E49%u0E43%u0E0A%u0E49
        //         document.getElementById("statusMessage").innerHTML = '<b>StatusMessage:</b> ' + profile.statusMessage;  // %u0E41%u0E2A%u0E14%u0E07%u0E2A%u0E16%u0E32%u0E19%u0E30%u0E02%u0E2D%u0E07%u0E1C%u0E39%u0E49%u0E43%u0E0A%u0E49 Line
        //         //document.getElementById("getDecodedIDToken").innerHTML = '<b>Email:</b> ' + liff.getDecodedIDToken().email;
        //     }).catch(err => console.error(err));
        // }
        // liff.init({ liffId: "2000534426-2E3BdkoV" }, () => { // เปลี่ยน LIFF ID 
        //     if (liff.isLoggedIn()) {
        //         runApp()
        //     } else {
        //         liff.login();
        //     }
        // }, err => console.error(err.code, error.message));

        // // logout
        // const accessToken = liff.getAccessToken();
        // if (accessToken) {
        //     fetch("https://api...", {
        //         headers: {
        //             "Content-Type": "application/json",
        //             Authorization: `Bearer ${accessToken}`
        //         }
        //         //...
        //     });
        // }


        function showFlex() {
            var x = document.getElementById("textBox2").value;
            try {
                document.getElementById('flex1').innerHTML = "";
                x = JSON.parse(x)
                console.log(x)
                var flexdat = {}
                flexdat["type"] = "flex";
                flexdat["altText"] = "Flex Message";
                flexdat["contents"] = x;
                flex2html("flex1", flexdat);
            }
            catch (err) {
                console.log(err)
                document.getElementById('flex1').innerHTML = "";
            }
        }

        function myFunction() {
            var altText = document.getElementById("textBox1").value;
            var message = document.getElementById("textBox2").value;
            // document.getElementById("demo").innerHTML = message;

            liff.init({ liffId: "2000534426-2E3BdkoV" });
            // liff.id equals to liffId
            liff.ready.then(() => {
                liff.sendMessages([
                    {
                        type: "flex",
                        altText: altText,
                        contents: JSON.parse(message),
                    },
                ])
                    .then(() => {
                        Swal.fire({
                            position: "center",
                            icon: "success",
                            title: "ส่ง Flex เรียบร้อย !",
                            showConfirmButton: false,
                            timer: 1500,
                        });
                        document.getElementById("textBox1").value = "";
                        document.getElementById("textBox2").value = "";

                        console.log("message sent");
                    })
                    .catch((err) => {
                        console.log("error", err);
                    });
            });
        }
        //จบฟังก์ชั่น
        function sendText() {
            var textUser = document.getElementById("textBox2").value

            liff.init({ liffId: "2000534426-2E3BdkoV" });
            // liff.id equals to liffId
            liff.ready.then(() => {
                liff.sendMessages([
                    {
                        "type": "text",
                        "text": textUser,
                    },
                ])
                    .then(() => {
                        Swal.fire({
                            position: "center",
                            icon: "success",
                            title: "ส่งข้อความเรียบร้อย !",
                            showConfirmButton: false,
                            timer: 1500,
                        });
                        document.getElementById("textBox1").value = "";
                        document.getElementById("textBox2").value = "";

                        console.log("message sent");
                    })
                    .catch((err) => {
                        console.log("error", err);
                    });
            });
        }

        //จบฟังก์ชั่น
        function sendImage() {
            var link1 = document.getElementById("textBox1").value;
            var link2 = document.getElementById("textBox2").value

            liff.init({ liffId: "2000534426-2E3BdkoV" });
            // liff.id equals to liffId
            liff.ready.then(() => {
                liff.sendMessages([
                    {
                        "type": "image",
                        "originalContentUrl": link1,
                        "previewImageUrl": link2
                    },
                ])
                    .then(() => {
                        Swal.fire({
                            position: "center",
                            icon: "success",
                            title: "ส่งภาพเรียบร้อย !",
                            showConfirmButton: false,
                            timer: 1500,
                        });
                        document.getElementById("textBox1").value = "";
                        document.getElementById("textBox2").value = "";

                        console.log("message sent");
                    })
                    .catch((err) => {
                        console.log("error", err);
                    });
            });
        }

        //จบฟังก์ชั่น
        function sendVideo() {
            var linkV1 = document.getElementById("textBox1").value;
            var linkV2 = document.getElementById("textBox2").value

            liff.init({ liffId: "2000534426-2E3BdkoV" });
            // liff.id equals to liffId
            liff.ready.then(() => {
                liff.sendMessages([
                    {
                        "type": "video",
                        "originalContentUrl": linkV1,
                        "previewImageUrl": linkV2,
                        //"trackingId": "track-id"
                    },
                ])
                    .then(() => {
                        Swal.fire({
                            position: "center",
                            icon: "success",
                            title: "ส่งวิดีโอเรียบร้อย !",
                            showConfirmButton: false,
                            timer: 1500,
                        });
                        document.getElementById("textBox1").value = "";
                        document.getElementById("textBox2").value = "";

                        console.log("message sent");
                    })
                    .catch((err) => {
                        console.log("error", err);
                    });
            });
        }

        //จบฟังก์ชั่น
        function sendLocation() {
            var lat = document.getElementById("textBox1").value;
            var lon = document.getElementById("textBox2").value

            liff.init({ liffId: "2000534426-2E3BdkoV" });
            // liff.id equals to liffId
            liff.ready.then(() => {
                liff.sendMessages([
                    {
                        "type": "location",
                        "title": "คุณได้รับโลเคชั่น จากฉันแล้ว...",
                        "address": "ที่อยู่นี้สามารถดูได้จากแผนที่",
                        "latitude": lat,
                        "longitude": lon
                    },
                ])
                    .then(() => {
                        Swal.fire({
                            position: "center",
                            icon: "success",
                            title: "ส่งโลเคชั่นเรียบร้อย !",
                            showConfirmButton: false,
                            timer: 1500,
                        });
                        document.getElementById("textBox1").value = "";
                        document.getElementById("textBox2").value = "";

                        console.log("message sent");
                    })
                    .catch((err) => {
                        console.log("error", err);
                    });
            });
        }


        function goSimulator() {
            liff.openWindow({
                url: "https://developers.line.biz/flex-simulator/",
                external: true,
            });
        }


    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>
